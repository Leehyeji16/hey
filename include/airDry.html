<div class="airdry_wrap">
  <div class="airdry_box">
    <button type="button" class="btn_back">ì—ì–´ ë“œë¼ì´</button>
    <p class="tit">Air Dry</p>
    <p class="airdry_status">
      AI ì œìŠµ ì¼€ì–´<span class="point_txt">ì§„í–‰ì¤‘</span>ì…ë‹ˆë‹¤.
    </p>
    <div class="airdry_img">
      <video class="airdry_video" autoplay muted playsinline loop></video>
      <img src="/assets/images/main/airdry_fan_off.png" alt="" class="off" />
    </div>
    <div class="airdry_btn_wrap">
      <button
        type="button"
        class="btn_mode sleep"
        data-video="/assets/video/airdry_sleep.mp4"
      >
        <span class="txt">ì·¨ì¹¨</span>
      </button>
      <button
        type="button"
        class="btn_mode normal active"
        data-video="/assets/video/airdry_normal.mp4"
      >
        <span class="txt">í‘œì¤€</span>
      </button>
      <button
        type="button"
        class="btn_mode turbo"
        data-video="/assets/video/airdry_normal.mp4"
      >
        <span class="txt">ì¾Œì†</span>
      </button>
      <button
        type="button"
        class="btn_mode auto"
        data-video="/assets/video/airdry_auto.webm"
      >
        <span class="txt">ìë™</span>
      </button>
    </div>
    <div class="humidity_btn_wrap">
      <div class="humidity_txt_box">
        <p class="humidity_txt">ì„¤ì • ìŠµë„</p>
        <p class="humidity_num">42%</p>
      </div>
      <button type="button" class="btn_airdry_power"></button>
      <div class="humidity_btn_box">
        <button type="button" class="btn_up">
          <span class="ic_arrow"></span>
        </button>
        <button type="button" class="btn_down">
          <span class="ic_arrow"></span>
        </button>
      </div>
    </div>
  </div>
  <button type="button" class="btn_close"></button>
</div>

<script>
  /* airDry ë²„íŠ¼ëª¨ìŒ (ë’¤ë¡œê°€ê¸°/ì°½ë‹«ê¸°) */
  const airDryCloseBtnWrap = () => {
    const airDry = document.getElementById("airDry");
    const mainPage = document.getElementById("mainPage");
    if (!airDry) return;

    const backBtn = airDry.querySelector(".btn_back");
    const closeBtn = airDry.querySelector(".btn_close");

    const removeActiveClass = () => {
      if (airDry.classList.contains("active")) {
        airDry.classList.remove("active");
        mainPage.classList.remove("slice_animation");
      }
    };

    if (backBtn) {
      backBtn.addEventListener("click", removeActiveClass);
    }

    if (closeBtn) {
      closeBtn.addEventListener("click", removeActiveClass);
    }
  };
  airDryCloseBtnWrap();

  /* airDry ë²„íŠ¼ëª¨ìŒ (ì·¨ì¹¨/í‘œì¤€/ì¾Œì†/ìë™) */
  const airDryLevelBtnWrap = () => {
    const airDry = document.getElementById("airDry");
    if (!airDry) return;

    const modeBtns = airDry.querySelectorAll(".airdry_btn_wrap .btn_mode");
    modeBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        modeBtns.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });
  };
  airDryLevelBtnWrap();

  /* airDry ì „ì›ë²„íŠ¼ */
  const airDryPowerBtnWrap = () => {
    const airDry = document.getElementById("airDry");
    if (!airDry) return;

    const powerBtn = airDry.querySelector(".btn_airdry_power");
    const airDryImg = airDry.querySelector(".airdry_img");
    const airDryBtnWrap = airDry.querySelector(".airdry_btn_wrap");
    const airDryStatus = airDry.querySelector(".airdry_status");
    const pointTxt = airDryStatus?.querySelector(".point_txt");
    const humidityNum = airDry.querySelector(".humidity_num");
    const modeBtns = airDry.querySelectorAll(".airdry_btn_wrap .btn_mode");

    if (
      !powerBtn ||
      !airDryImg ||
      !airDryBtnWrap ||
      !airDryStatus ||
      !pointTxt ||
      !humidityNum
    )
      return;

    let lastActiveBtn = document.querySelector(
      ".airdry_btn_wrap .btn_mode.active"
    );
    const originalHumidity = humidityNum.textContent.trim(); // ê¸°ì¡´ ìŠµë„ê°’ ì €ì¥ (ì˜ˆ: "42%")

    let spinTimeoutId = null;

    // ğŸ‘‰ ì´ˆê¸° ìƒíƒœ: ì „ì› êº¼ì§ìœ¼ë¡œ ì„¸íŒ…
    powerBtn.classList.add("off");
    airDryImg.classList.add("has_off");
    airDryStatus.classList.add("has_off");
    airDryBtnWrap.classList.add("has_off");
    modeBtns.forEach((b) => b.classList.remove("active"));
    pointTxt.textContent = "ì‘ë™ ì „";
    humidityNum.textContent = "-";

    // ì „ì› ë²„íŠ¼ í´ë¦­
    powerBtn.addEventListener("click", () => {
      const isOff = powerBtn.classList.toggle("off");

      airDryImg.classList.toggle("has_off", isOff);
      airDryBtnWrap.classList.toggle("has_off", isOff);
      airDryStatus.classList.toggle("has_off", isOff);

      // ì• ë‹ˆë©”ì´ì…˜ íƒ€ì´ë¨¸/í´ë˜ìŠ¤ ì´ˆê¸°í™”
      if (spinTimeoutId !== null) {
        clearTimeout(spinTimeoutId);
        spinTimeoutId = null;
      }
      airDryImg.classList.remove("is_on");

      if (isOff) {
        // ğŸ”Œ ì „ì› êº¼ì§
        modeBtns.forEach((b) => b.classList.remove("active"));
        pointTxt.textContent = "ì‘ë™ ì „";
        humidityNum.textContent = "-";
      } else {
        // ğŸ”Œ ì „ì› ì¼œì§
        if (lastActiveBtn) lastActiveBtn.classList.add("active");
        pointTxt.textContent = "ì§„í–‰ì¤‘";
        humidityNum.textContent = originalHumidity;

        // â± 1ì´ˆ ë’¤ì— íŒ¬ íšŒì „ ì‹œì‘
        spinTimeoutId = setTimeout(() => {
          airDryImg.classList.add("is_on");
        }, 1000);
      }
    });

    // ëª¨ë“œ ë²„íŠ¼ í´ë¦­
    modeBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        if (powerBtn.classList.contains("off")) return; // ì „ì› êº¼ì ¸ ìˆìœ¼ë©´ ë™ì‘ ì•ˆ í•¨

        modeBtns.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        lastActiveBtn = btn;
      });
    });
  };

  airDryPowerBtnWrap();
  /* ì—ì–´ë“œë¼ì´ ì˜ìƒ ë³€ê²½ ê¸°ëŠ¥ ì¶”ê°€ */
  const airDryVideoController = () => {
    const airDry = document.getElementById("airDry");
    if (!airDry) return;

    const wrap = airDry.querySelector(".airdry_wrap");
    const powerBtn = airDry.querySelector(".btn_airdry_power");
    const videoEl = airDry.querySelector(".airdry_video");
    const fanOffImg = airDry.querySelector(".airdry_img .off");
    const modeBtns = airDry.querySelectorAll(".airdry_btn_wrap .btn_mode");

    if (!powerBtn || !videoEl || !fanOffImg || modeBtns.length === 0) return;

    const playVideoForBtn = (btn) => {
      const src = btn?.dataset?.video;
      if (!src) return;

      videoEl.src = src;
      videoEl.style.display = "block";
      fanOffImg.style.display = "none";

      videoEl.load();
      videoEl.play();
    };

    modeBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        if (powerBtn.classList.contains("off")) return;
        playVideoForBtn(btn);
      });
    });

    powerBtn.addEventListener("click", () => {
      const isOff = powerBtn.classList.contains("off");

      if (!isOff) {
        const activeBtn = wrap.querySelector(".btn_mode.active") || modeBtns[0];
        if (activeBtn) playVideoForBtn(activeBtn);
      } else {
        fanOffImg.style.display = "block";
        videoEl.style.display = "none";
        videoEl.pause();
      }
    });

    // ì´ˆê¸° ë¹„ë””ì˜¤ ìƒíƒœë¥¼ íŒ¬ ì •ì§€ ì´ë¯¸ì§€ë¡œ ê³ ì •
    fanOffImg.style.display = "block";
    videoEl.style.display = "none";
  };

  airDryVideoController();
</script>
